<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LookList – Sign in / Sign up</title>
  <meta name="description" content="Sign in or create an account to manage your LookList bookings, messages, and profile." />
  <link rel="icon" href="assets/logo1.png" type="image/png" sizes="any" />
  <link rel="apple-touch-icon" href="assets/logo1.png" />
  <link rel="shortcut icon" href="assets/logo1.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* ... original styles unchanged ... */
  </style>
</head>
<body>
  <header class="header-bar">
    <a href="index.html"><img src="assets/logo1.png" alt="LookList Logo" class="logo-img" /></a>
    <span class="header-title">LookList <span data-auth="user-name" class="user-greeting" hidden></span></span>
    <a href="index.html" class="home-link hide-mobile">Home</a>
    <a href="services.html" class="home-link nav-desktop">Services</a>
    <a href="messages.html" class="home-link nav-desktop">Messages</a>
    <a href="profile.html" class="home-link nav-desktop">Profile</a>
    <a href="signin.html" class="home-link nav-desktop" data-auth="signin" aria-current="page">Sign in</a>
    <a href="services.html" class="home-link show-mobile">Services</a>
    <a href="messages.html" class="home-link show-mobile">Messages</a>
    <a href="profile.html" class="home-link show-mobile">Profile</a>
    <a href="signin.html" class="home-link show-mobile" data-auth="signin" aria-current="page">Sign in</a>
  </header>

  <main class="auth-wrap">
    <section class="auth-card" aria-labelledby="authTitle">
      <h1 id="authTitle" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden;">Sign in or Sign up</h1>
      <div class="auth-header" role="tablist" aria-label="Authentication tabs">
        <button id="tab-signin" class="tab-btn" role="tab" aria-selected="true" aria-controls="panel-signin">Sign In</button>
        <button id="tab-signup" class="tab-btn" role="tab" aria-selected="false" aria-controls="panel-signup">Sign Up</button>
      </div>
      <div class="divider" aria-hidden="true"></div>

      <!-- Sign In Panel -->
      <section id="panel-signin" class="auth-body" role="tabpanel" aria-labelledby="tab-signin">
        <div id="signin-status" aria-live="polite"></div>
        <form id="signin-form" novalidate>
          <div class="form-row">
            <label for="signin-email">Email</label>
            <input id="signin-email" name="email" type="email" class="input" autocomplete="email" required placeholder="you@example.com" />
            <div class="error" id="signin-email-error" hidden></div>
          </div>
          <div class="form-row">
            <label for="signin-password">Password</label>
            <input id="signin-password" name="password" type="password" class="input" autocomplete="current-password" required placeholder="Your password" />
            <div class="error" id="signin-password-error" hidden></div>
          </div>
          <div class="actions">
            <label style="display:flex;align-items:center;gap:0.5rem;">
              <input id="remember-me" type="checkbox" /> <span class="muted">Remember me</span>
            </label>
            <button type="submit" class="btn">Sign In</button>
          </div>
          <p class="muted">Don't have an account? <a href="#" id="go-signup">Create one</a>.</p>
        </form>
      </section>

      <!-- Sign Up Panel -->
      <section id="panel-signup" class="auth-body" role="tabpanel" aria-labelledby="tab-signup" hidden>
        <div id="signup-status" aria-live="polite"></div>
        <form id="signup-form" novalidate>
          <div class="row-split">
            <div class="form-row">
              <label for="signup-name">Full name</label>
              <input id="signup-name" name="name" type="text" class="input" autocomplete="name" required placeholder="Jane Doe" />
              <div class="error" id="signup-name-error" hidden></div>
            </div>
            <div class="form-row">
              <label for="signup-email">Email</label>
              <input id="signup-email" name="email" type="email" class="input" autocomplete="email" required placeholder="you@example.com" />
              <div class="error" id="signup-email-error" hidden></div>
            </div>
          </div>
          <div class="row-split">
            <div class="form-row">
              <label for="signup-password">Password</label>
              <input id="signup-password" name="password" type="password" class="input" autocomplete="new-password" required placeholder="At least 8 characters" />
              <div class="error" id="signup-password-error" hidden></div>
              <div class="form-help">Use 8+ characters with a mix of letters and numbers.</div>
            </div>
            <div class="form-row">
              <label for="signup-confirm">Confirm password</label>
              <input id="signup-confirm" name="confirm" type="password" class="input" autocomplete="new-password" required placeholder="Re-enter password" />
              <div class="error" id="signup-confirm-error" hidden></div>
            </div>
          </div>
          <label style="display:flex;align-items:center;gap:0.5rem;margin-top:0.25rem;">
            <input id="signup-terms" type="checkbox" required />
            <span class="muted">I accept the <a href="terms.html">Terms</a> and <a href="privacy.html">Privacy Policy</a>.</span>
          </label>
          <div class="actions">
            <span></span>
            <button type="submit" class="btn">Create Account</button>
          </div>
          <p class="muted">Already have an account? <a href="#" id="go-signin">Sign in</a>.</p>
        </form>
      </section>

      <div class="divider" aria-hidden="true"></div>
      <p class="muted">
        This page uses Supabase for authentication. If you don’t receive a confirmation email after sign up, check your spam folder.
      </p>
    </section>
  </main>

  <footer>
    <nav class="footer-nav">
      <a href="terms.html"><button class="footer-btn">Terms of Use</button></a>
      <a href="privacy.html"><button class="footer-btn">Privacy Policy</button></a>
      <a href="cookies.html"><button class="footer-btn">Cookie Policy</button></a>
    </nav>
    <div>© 2025 LookList. All rights reserved.</div>
  </footer>

  <nav class="mobile-bottom-nav" aria-label="Primary">
    <a class="nav-item" href="index.html">
      <img class="nav-icon" src="assets/home.png" alt="" aria-hidden="true" />
      <span class="nav-label">Home</span>
    </a>
    <a class="nav-item" href="services.html">
      <img class="nav-icon" src="assets/service.png" alt="" aria-hidden="true" />
      <span class="nav-label">Services</span>
    </a>
    <a class="nav-item" href="messages.html">
      <img class="nav-icon" src="assets/messages.png" alt="" aria-hidden="true" />
      <span class="nav-label">Messages</span>
    </a>
    <a class="nav-item" href="profile.html">
      <img class="nav-icon" src="assets/profile.png" alt="" aria-hidden="true" />
      <span class="nav-label">Profile</span>
    </a>
    <a class="nav-item" href="signin.html" data-auth="signin" aria-current="page">
      <img class="nav-icon" src="assets/profile.png" alt="" aria-hidden="true" />
      <span class="nav-label">Sign in</span>
    </a>
  </nav>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="auth.js"></script>
  <script>
    (async function init() {
      try {
        if (window.authInit) {
          const { user } = await window.authInit();
          const signInLinks = document.querySelectorAll('[data-auth="signin"]');
          if (user) {
            signInLinks.forEach(el => {
              el.textContent = 'Sign Out';
              el.onclick = (e) => { e.preventDefault(); authSignOut(); };
              el.setAttribute('href', '#');
            });
          } else {
            signInLinks.forEach(el => {
              el.textContent = 'Sign in';
              el.onclick = null;
              el.setAttribute('href', 'signin.html');
            });
          }
        }
      } catch (e) { console.warn('Auth init warning:', e); }
      setActiveTab('signin');
    })();

    // Tabs
    const tabSignin = document.getElementById('tab-signin');
    const tabSignup = document.getElementById('tab-signup');
    const panelSignin = document.getElementById('panel-signin');
    const panelSignup = document.getElementById('panel-signup');
    function setActiveTab(tab) {
      const isSignin = tab === 'signin';
      tabSignin.setAttribute('aria-selected', String(isSignin));
      tabSignup.setAttribute('aria-selected', String(!isSignin));
      panelSignin.hidden = !isSignin;
      panelSignup.hidden = isSignin;
      (isSignin ? document.getElementById('signin-email') : document.getElementById('signup-name')).focus();
    }
    tabSignin.addEventListener('click', () => setActiveTab('signin'));
    tabSignup.addEventListener('click', () => setActiveTab('signup'));
    document.getElementById('go-signup')?.addEventListener('click', (e) => { e.preventDefault(); setActiveTab('signup'); });
    document.getElementById('go-signin')?.addEventListener('click', (e) => { e.preventDefault(); setActiveTab('signin'); });

    // Choose client based on "Remember me"
    function activeClient(remember) {
      return remember ? window.authClients.spLocal : window.authClients.spSession;
    }
    function persistentClient() { return window.authClients.spLocal; }

    window.authClients.spLocal.auth.onAuthStateChange((_e, session) => { if (session) window.location.replace('profile.html'); });
    window.authClients.spSession.auth.onAuthStateChange((_e, session) => { if (session) window.location.replace('profile.html'); });

    // Sign In (Supabase)
    document.getElementById('signin-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('signin-email').value.trim().toLowerCase();
      const password = document.getElementById('signin-password').value;
      const remember = document.getElementById('remember-me').checked;

      const emailErr = document.getElementById('signin-email-error');
      const passErr = document.getElementById('signin-password-error');
      const status = document.getElementById('signin-status');

      emailErr.hidden = true; emailErr.textContent = '';
      passErr.hidden = true; passErr.textContent = '';
      status.textContent = '';

      let ok = true;
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { emailErr.hidden = false; emailErr.textContent = 'Enter a valid email.'; ok = false; }
      if (!password) { passErr.hidden = false; passErr.textContent = 'Enter your password.'; ok = false; }
      if (!ok) return;

      try {
        const { error } = await activeClient(remember).auth.signInWithPassword({ email, password });
        if (error) throw error;
        status.innerHTML = '<span class="success">Signed in! Redirecting…</span>';
        setTimeout(() => { window.location.replace('profile.html'); }, 400);
      } catch (err) {
        status.innerHTML = `<span class="error">${err?.message || 'Sign in failed'}</span>`;
      }
    });

    // Sign Up (Supabase) – stores "name" in user metadata
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('signup-email').value.trim().toLowerCase();
      const password = document.getElementById('signup-password').value;
      const name = document.getElementById('signup-name').value.trim();
      const confirm = document.getElementById('signup-confirm').value;
      const terms = document.getElementById('signup-terms').checked;

      const status = document.getElementById('signup-status');
      status.textContent = '';

      if (password !== confirm) {
        status.innerHTML = '<span class="error">Passwords do not match.</span>';
        return;
      }
      if (!terms) {
        status.innerHTML = '<span class="error">You must accept the Terms.</span>';
        return;
      }

      try {
        const { error } = await persistentClient().auth.signUp({
          email,
          password,
          options: { data: { name } }
        });
        if (error) throw error;
        status.innerHTML = '<span class="success">Check your email to confirm your account!</span>';
      } catch (err) {
        status.innerHTML = `<span class="error">${err?.message || 'Sign up failed'}</span>`;
      }
    });
  </script>
</body>
</html>